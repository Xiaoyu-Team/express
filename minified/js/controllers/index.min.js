var db=require("../../config/mongoose")(),MovieSchema=require("../schemas/movie"),Movie=db.model("Movie",MovieSchema),CatetorySchema=require("../schemas/catetory"),Catetory=db.model("Catetory",CatetorySchema);exports.index=function(e,o){console.log("user in session:"),console.log(e.session.user),Catetory.find({}).populate({path:"movies",options:{limit:5}}).exec(function(e,t){e&&console.log(e),o.render("index",{title:"imooc 扶뒬못",catetories:t})})},exports.search=function(e,o){var t=e.query.cat,i=e.query.p,r=2*i,a=2;Catetory.find({_id:t}).populate({path:"movies"}).exec(function(e,c){e&&console.log(e);var c=c[0]||[],s=c.movies.slice(r,r+a),n=Math.ceil(c.movies.length/a);o.render("result",{title:"imooc 扶뒬못",cat:s,keyword:c.name,currentPage:i+1,totalPage:n,catId:t})})};